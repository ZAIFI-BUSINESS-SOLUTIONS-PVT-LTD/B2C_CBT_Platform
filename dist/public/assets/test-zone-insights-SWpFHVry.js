import{y as M,r as d,A as _,ao as v,j as e,v as E,C as h,b as u,ai as U,aj as O,ak as Q,al as W,am as q,an as Z,B as N,$ as k}from"./index-DO7ipTtv.js";import{T as J}from"./trophy-DXzqvxS5.js";import{T as $}from"./target-tuS1hT4-.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],G=M("trending-up",V);function X(){const[T,F]=d.useState([]),[m,S]=d.useState(null),[x,y]=d.useState(null),[z,g]=d.useState([]),[p,I]=d.useState(!1),[L,b]=d.useState(null),[P,A]=d.useState(!0);d.useEffect(()=>{B()},[]),d.useEffect(()=>{m?R(m):(y(null),g([]))},[m]);const B=async()=>{var r;try{A(!0);const s=`${_.BASE_URL}/api/zone-insights/tests/`;console.log("Fetching test list from:",s);const n=await v(s);if(!n.ok){const t=await n.text();throw console.error("API Error Response:",n.status,t),new Error(`Failed to fetch test list: ${n.status}`)}const l=await n.json();console.log("Test list API response:",l),console.log("Number of tests:",(r=l.tests)==null?void 0:r.length),l.tests&&l.tests.length>0&&console.log("First test sample:",JSON.stringify(l.tests[0],null,2));const o=(l.tests||[]).map(t=>({id:t.id,test_name:t.test_name||t.testName||t.get_test_name||t.getTestName||"Unnamed Test",test_type:t.test_type||t.testType||"custom",start_time:t.start_time||t.startTime||null,end_time:t.end_time||t.endTime||null,total_marks:t.total_marks??t.totalMarks??t.total_marks_calc??t.totalMarksCalc??0,max_marks:t.max_marks??t.maxMarks??0,total_questions:t.total_questions??t.totalQuestions??0,correct_answers:t.correct_answers??t.correctAnswers??0,incorrect_answers:t.incorrect_answers??t.incorrectAnswers??0,unanswered:t.unanswered??t.unansweredQuestions??t.unansweredQuestions??0}));F(o),S(t=>t??(o.length>0?o[0].id:null)),b(null)}catch(s){console.error("Error fetching test list:",s),b("Failed to load test list. Please try refreshing the page.")}finally{A(!1)}},R=async r=>{try{I(!0),b(null);const s=`${_.BASE_URL}/api/zone-insights/test/${r}/`;console.log("ðŸ” Fetching zone insights from:",s);const n=await v(s);if(console.log("ðŸ“¡ API Response status:",n.status,n.ok),!n.ok){const i=await n.text();throw console.error("âŒ API Error:",i),new Error("Failed to fetch zone insights")}const l=await n.json();console.log("âœ… Received data:",JSON.stringify(l,null,2));const o=l.test_info||l.testInfo||{},t={id:o.id,test_name:o.test_name||o.testName||o.get_test_name||o.getTestName||"Unnamed Test",start_time:o.start_time||o.startTime||null,end_time:o.end_time||o.endTime||null,total_marks:o.total_marks??o.totalMarks??0,max_marks:o.max_marks??o.maxMarks??0,percentage:o.percentage??0,subject_marks:(()=>{const i=o.subject_marks||o.subjectMarks||{},c={};return Object.entries(i).forEach(([j,w])=>{const a=w||{};c[j]={score:a.score??a.score??0,correct:a.correct??a.correct??a.correctAnswers??a.correct_answers??0,incorrect:a.incorrect??a.incorrect??a.incorrectAnswers??a.incorrect_answers??0,unanswered:a.unanswered??a.unanswered??a.unansweredQuestions??a.unanswered_questions??0,marks:a.marks??a.marks??0,max_marks:a.max_marks??a.maxMarks??a.max_marks??0}}),c})()};console.log("ðŸ“Š Normalized test_info:",t),y(t);const f=l.zone_insights||l.zoneInsights||[];if(console.log("ðŸŽ¯ Primary zone_insights count:",f.length),!f||f.length===0)try{console.debug("Primary zone_insights empty â€” fetching raw DB-backed insights as fallback");const i=`${_.BASE_URL}/api/zone-insights/raw/${r}/`,c=await v(i);if(c.ok){const j=await c.json();console.debug("Raw insights response:",j);const w=j.raw_insights||j.rawInsights||[];g(w.map(a=>({subject:a.subject,steady_zone:a.steady_zone||a.steadyZone||[],edge_zone:a.edge_zone||a.edgeZone||[],focus_zone:a.focus_zone||a.focusZone||[]})))}else console.warn("Raw insights fetch failed",c.status),g([])}catch(i){console.error("Error fetching raw insights fallback:",i),g([])}else{const i=f.map(c=>({subject:c.subject,steady_zone:c.steady_zone||c.steadyZone||[],edge_zone:c.edge_zone||c.edgeZone||[],focus_zone:c.focus_zone||c.focusZone||[]}));g(i)}}catch(s){console.error("Error fetching zone insights:",s),b("Failed to load zone insights"),y(null),g([])}finally{I(!1)}},C=r=>{if(!r)return"No Date";try{const s=new Date(r);if(isNaN(s.getTime()))return"Invalid Date";const n=s.getDate().toString().padStart(2,"0"),l=s.toLocaleString("default",{month:"short"}),o=s.getFullYear().toString().slice(-2);return`${n} ${l} ${o}`}catch(s){return console.error("Error formatting date:",r,s),"Invalid Date"}},D=r=>({Physics:"bg-blue-100 text-blue-700 border-blue-300",Chemistry:"bg-green-100 text-green-700 border-green-300",Botany:"bg-emerald-100 text-emerald-700 border-emerald-300",Zoology:"bg-teal-100 text-teal-700 border-teal-300",Math:"bg-purple-100 text-purple-700 border-purple-300"})[r]||"bg-gray-100 text-gray-700 border-gray-300";return P?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(E,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading tests..."})]}):T.length===0?e.jsx(h,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(J,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Tests Available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Complete a test to see your subject-wise performance insights with AI-powered recommendations."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{children:e.jsxs(u,{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select a Test to Analyze"}),e.jsxs(U,{value:(m==null?void 0:m.toString())||"",onValueChange:r=>S(r?Number(r):null),children:[e.jsx(O,{className:"w-full",children:e.jsx(Q,{placeholder:"Choose a test..."})}),e.jsx(W,{children:T.map(r=>{const s=C(r.start_time),n=`${r.total_marks??0}/${r.max_marks??0}`;return e.jsxs(q,{value:r.id.toString(),children:[r.test_name||"Unnamed Test"," - ",s," (",n,")"]},r.id)})})]})]})}),p&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(E,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading insights..."})]}),L&&!p&&e.jsx(h,{className:"border-red-200 bg-red-50",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Z,{className:"h-5 w-5"}),e.jsx("p",{className:"font-medium",children:L})]})})}),x&&!p&&e.jsx(h,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:x.test_name}),e.jsxs(N,{variant:"secondary",className:"bg-white",children:[x.percentage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Score"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[x.total_marks," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["/ ",x.max_marks]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Test Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:C(x.start_time)})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:Object.entries(x.subject_marks).filter(([r,s])=>{const n=(s==null?void 0:s.max_marks)??0,l=((s==null?void 0:s.correct)??0)+((s==null?void 0:s.incorrect)??0)+((s==null?void 0:s.unanswered)??0);return n>0||l>0}).map(([r,s])=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-blue-100",children:[e.jsx("p",{className:"text-xs text-gray-600",children:r}),e.jsxs("div",{className:"flex items-baseline gap-1 min-w-0 flex-wrap",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.marks}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/ ",s.max_marks]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-medium bg-green-50 text-green-800 border border-green-100",children:[e.jsx("svg",{className:"h-3.5 w-3.5 mr-1 text-green-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),s.correct??0]}),e.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-medium bg-red-50 text-red-800 border border-red-100",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 mr-1 text-red-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),s.incorrect??0]}),e.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-medium bg-gray-50 text-gray-800 border border-gray-100",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 mr-1 text-gray-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"7"}),e.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",className:"text-gray-600"})]}),s.unanswered??0]})]})]})]},r))})]})}),z.length>0&&!p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 px-1",children:"Subject-Wise Performance Zones"}),z.map(r=>e.jsxs(h,{className:"overflow-hidden",children:[e.jsx("div",{className:`${D(r.subject)} border-b-2 px-4 py-2`,children:e.jsx("h4",{className:"font-bold text-lg",children:r.subject})}),e.jsxs(u,{className:"p-0",children:[e.jsxs("div",{className:"p-4 border-b bg-green-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"bg-green-500 rounded-full p-1",children:e.jsx($,{className:"h-4 w-4 text-white"})}),e.jsx("h5",{className:"font-semibold text-green-800",children:"Steady Zone"}),e.jsx(N,{variant:"outline",className:"ml-auto text-xs bg-green-100 text-green-700 border-green-300",children:"Strong Areas"})]}),e.jsx("ul",{className:"space-y-2",children:r.steady_zone.map((s,n)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 leading-relaxed",children:s})]},n))})]}),e.jsxs("div",{className:"p-4 border-b bg-orange-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"bg-orange-500 rounded-full p-1",children:e.jsx(G,{className:"h-4 w-4 text-white"})}),e.jsx("h5",{className:"font-semibold text-orange-800",children:"Edge Zone"}),e.jsx(N,{variant:"outline",className:"ml-auto text-xs bg-orange-100 text-orange-700 border-orange-300",children:"Needs Practice"})]}),e.jsx("ul",{className:"space-y-2",children:r.edge_zone.map((s,n)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 leading-relaxed",children:s})]},n))})]}),e.jsxs("div",{className:"p-4 bg-red-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"bg-red-500 rounded-full p-1",children:e.jsx(Z,{className:"h-4 w-4 text-white"})}),e.jsx("h5",{className:"font-semibold text-red-800",children:"Focus Zone"}),e.jsx(N,{variant:"outline",className:"ml-auto text-xs bg-red-100 text-red-700 border-red-300",children:"Priority Areas"})]}),e.jsx("ul",{className:"space-y-2",children:r.focus_zone.map((s,n)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700 leading-relaxed",children:s})]},n))})]})]})]},r.subject))]}),!m&&!p&&e.jsx(h,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx($,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select a Test to Begin"}),e.jsx("p",{className:"text-gray-600",children:"Choose a test from the dropdown above to see detailed subject-wise performance insights with AI-powered recommendations."})]})})]})}export{X as T,G as a};
