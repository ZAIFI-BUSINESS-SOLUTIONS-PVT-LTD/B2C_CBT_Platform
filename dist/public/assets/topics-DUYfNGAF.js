import{a as le,z as Ne,r,i as G,u as ve,A as R,D as V,E as ye,j as e,C as F,c as pe,F as te,b as U,d as ze,X as je,H as K,f as h,B as $e,P as fe,J as Q,K as Ae,N as Fe,O as Ue,Q as Qe,R as Be,U as De,e as we,V as Ye,W as He,Y as Je,Z as Ke,_ as Xe,$ as Ge}from"./index-DO7ipTtv.js";import{S as be,a as Ce,L as Ve,b as Ze,c as We,C as es,d as ss}from"./slider-kZmb7TNc.js";import{T as ae}from"./target-tuS1hT4-.js";import{M as ts}from"./mobile-dock-Ds855vfF.js";import"./notepad-text-BLVCxvgk.js";function as(){var ge;const[,v]=le(),{toast:N}=Ne(),[l,y]=r.useState(1),f=6,[B,T]=r.useState("custom"),[c,w]=r.useState([]),[o,L]=r.useState([]),[d,C]=r.useState([]),[u,I]=r.useState(60),[b,D]=r.useState(20),[Y,k]=r.useState("questions"),p=()=>{l<f&&y(l+1)},Z=()=>{l>1&&y(l-1)},[O,W]=r.useState([]);r.useState([]);const[n,x]=r.useState(""),[z,ie]=r.useState(!1),[Se,H]=r.useState(!1),[m,Te]=r.useState(null),{data:_,isLoading:ne,error:re}=G({queryKey:["allTopics"],queryFn:async()=>{let s=[],t=`${R.BASE_URL}${R.ENDPOINTS.TOPICS}`;for(console.log("ðŸ”„ Starting to fetch all topics...");t;){console.log("ðŸ“¡ Fetching page:",t);const a=await fetch(t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status} for URL: ${t}`);const i=await a.json();console.log(`âœ… Fetched ${i.results.length} topics from this page. Total so far: ${s.length+i.results.length}`),s=s.concat(i.results),t=i.next}return console.log(`ðŸŽ‰ Finished fetching all topics. Total: ${s.length}`),{results:s,count:s.length}}});console.log("ðŸ“Š Topics query state:",{isLoading:ne,error:re,totalTopics:(ge=_==null?void 0:_.results)==null?void 0:ge.length});const g=(_==null?void 0:_.results)||[];r.useEffect(()=>{if(g.length>0){const s=[...new Set(g.map(a=>a.subject))],t=[...new Set(g.map(a=>`${a.subject}-${a.chapter}`))].length;console.log("ðŸ“š Topics loaded:",{totalTopics:g.length,subjects:s,totalChapters:t,sampleTopics:g.slice(0,3)}),s.forEach(a=>{const i=g.filter(S=>S.subject===a),j=[...new Set(i.map(S=>S.chapter))];console.log(`ðŸ“– ${a}: ${i.length} topics, ${j.length} chapters`,j)}),console.log("ðŸ”¬ Raw topic sample:",JSON.stringify(g.slice(0,2),null,2))}},[g]);const{student:ee}=ve(),{data:qe,isLoading:ce}=G({queryKey:["topicQuestionCounts",c,o,l],queryFn:async()=>{if(l!==3||c.length===0||o.length===0)return{};const t=E(c,o).map(M=>M.id);if(t.length===0)return{};const a=new URLSearchParams;t.forEach(M=>a.append("topic_ids",String(M)));const i=`${R.ENDPOINTS.TOPIC_QUESTION_COUNTS}?${a.toString()}`;console.log("ðŸ“¡ Fetching exact question counts:",i);const j=await V(i,"GET"),S=(j==null?void 0:j.counts)||{};return console.log("âœ… Received exact topic counts:",S),S},enabled:l===3&&c.length>0&&o.length>0,staleTime:1e3*60*5,gcTime:1e3*60*10}),oe=qe||{},{data:J,isLoading:de,error:is}=G({queryKey:["availableQuestions",d],queryFn:async()=>{if(d.length===0)return{available:0};const s=new URLSearchParams;d.forEach(S=>s.append("topic_ids",String(S)));const t=`${R.ENDPOINTS.TOPIC_QUESTION_COUNTS}?${s.toString()}`;console.log("ðŸ“¡ Fetching total available questions for selected topics:",t);const a=await V(t,"GET"),i=(a==null?void 0:a.counts)||{},j=Object.values(i).reduce((S,M)=>S+(typeof M=="number"?M:0),0);return console.log("âœ… Total available questions for selected topics:",j),{available:j}},enabled:d.length>0&&l===4,staleTime:1e3*60*5,gcTime:1e3*60*10}),q=(J==null?void 0:J.available)??0,Le=d.length>0&&l===4;console.log("ðŸ”§ Query debug:",{selectedTopicsCount:d.length,currentStep:l,shouldQueryRun:Le,isLoading:de,hasData:!!J,availableQuestions:q}),console.log("ðŸŽ¯ Available questions:",q,"Query enabled:",d.length>0&&l===4);const se=ye({mutationFn:async s=>{const t={...s,studentId:ee==null?void 0:ee.studentId};return await V(R.ENDPOINTS.TEST_SESSIONS,"POST",t)},onSuccess:s=>{v(`/test/${s.session.id}`)},onError:s=>{console.log("âŒ Test creation failed in mutation:",s.message),console.log("âŒ Full error object:",s),console.log("âŒ Error details:",s.details);let t=null;try{if(s.message){const a=s.message.match(/^\d+:\s*(.+)$/);a&&(t=JSON.parse(a[1]))}if(!t&&s.details)if(typeof s.details=="string")try{t=JSON.parse(s.details)}catch{console.log("âŒ Could not parse error.details as JSON")}else typeof s.details=="object"&&(t=s.details);console.log("ðŸ” Final error data:",t)}catch{console.error("Error parsing mutation error:",s.message)}(t==null?void 0:t.error)==="Insufficient questions available"?(Te({available:t.available_questions,requested:t.requested_questions,message:t.message||"Not enough questions available for this test configuration."}),H(!0)):N({title:"Failed to create test",description:"Could not create test session.",variant:"destructive"})}});r.useEffect(()=>{g.length>0&&O.length===0&&W([])},[g]);const me=1,Ie=1.5,$=me,P=r.useMemo(()=>Math.max(me,Math.ceil(b*Ie)),[b]);r.useEffect(()=>{u>P&&I(P),u<$&&I($)},[P,u]);const ke=s=>{D(s),I(s),k("questions")},Ee=s=>{let t=s[0];t<$&&(t=$),t>P&&(t=P),I(t),k("time")},A=s=>{if(s.length===0)return[];const t=g.filter(i=>s.some(j=>i.subject&&i.subject.toLowerCase()===j.toLowerCase()));return[...new Set(t.map(i=>i.chapter).filter(i=>i!=null&&typeof i=="string"&&i.trim()!==""))]},_e=(s,t)=>s.length===0||!t?[]:g.filter(a=>s.some(i=>a.subject&&a.subject.toLowerCase()===i.toLowerCase())&&a.chapter===t),E=(s,t)=>s.length===0||t.length===0?[]:g.filter(a=>s.some(i=>a.subject&&a.subject.toLowerCase()===i.toLowerCase())&&a.chapter&&t.includes(a.chapter)),Pe=s=>{w(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]),L([])},Me=s=>{L(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},xe=()=>{const s=A(c);o.length===s.length?L([]):L(s)},Re=()=>{const s=d;if(s.length===0){N({title:"No topics selected",description:"Please select at least one topic for your test.",variant:"destructive"});return}if(Y==="questions"){if(!b||b<=0){N({title:"Invalid question count",description:"Please set a valid number of questions.",variant:"destructive"});return}}else if(!u||u<=0){N({title:"Invalid time limit",description:"Please set a valid time limit.",variant:"destructive"});return}const t=Y==="questions"?"question_count":"time_limit",a={selected_topics:s,selection_mode:t,test_type:B};t==="question_count"?a.question_count=b:a.time_limit=u,console.log("ðŸš€ Creating custom test with payload:",a),se.mutate(a)},Oe=s=>{switch(s){case"Physics":return e.jsx(Je,{className:"h-6 w-6 text-blue-600"});case"Chemistry":return e.jsx(He,{className:"h-6 w-6 text-green-600"});case"Botany":return e.jsx(Ze,{className:"h-6 w-6 text-emerald-600"});case"Zoology":return e.jsx(Ye,{className:"h-6 w-6 text-purple-600"});default:return e.jsx(Ve,{className:"h-6 w-6 text-gray-600"})}};g.filter(s=>{if(!n)return!1;const t=n.toLowerCase();return s.name.toLowerCase().includes(t)||s.subject.toLowerCase().includes(t)||s.chapter&&s.chapter.toLowerCase().includes(t)});const he=s=>{x(s),ie(s.length>0)},ue=()=>{x(""),ie(!1)};return ne?e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(F,{className:"shadow-xl",children:[e.jsxs(pe,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:[e.jsx(te,{className:"h-8 w-64"}),e.jsx(te,{className:"h-4 w-96"})]}),e.jsx(U,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(s=>e.jsx(te,{className:"h-32 w-full"},s))})})]})})})}):re?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs(F,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsx(ze,{className:"text-red-600",children:"Error Loading Topics"})}),e.jsx(U,{children:e.jsx("p",{className:"text-gray-600",children:"Failed to load topics. Please try refreshing the page."})})]})}):e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"fixed top-12 left-0 right-0 z-50 bg-white border-b border-gray-200 p-4 shadow-sm",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Step ",l," of ",f]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[l===1&&"Select Subjects",l===2&&"Select Chapters",l===3&&"Select Topics",l===4&&"Configure Test",l===5&&"Review Test",l===6&&"Create Test"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${l/f*100}%`}})})]})})}),e.jsx("div",{className:"container mx-auto pb-3 pt-20",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(F,{children:e.jsxs(U,{className:"px-2 pb-24",children:[l===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Select Chapters"}),e.jsxs("p",{className:"text-gray-600",children:["Choose one or more chapters from ",c.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(be,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search chapters...",value:n,onChange:s=>he(s.target.value),className:"w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),n&&e.jsx("button",{onClick:ue,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(je,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border",children:e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:xe,children:[e.jsx(K,{checked:o.length===A(c).length&&A(c).length>0,className:"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Select All Chapters"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[A(c).length," chapters available"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:(()=>{const s=A(c).filter(t=>!n||t.toLowerCase().includes(n.toLowerCase()));return s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"No chapters found"}),e.jsx("p",{className:"text-sm",children:c.length===0?"Please select at least one subject first":g.length===0?"Loading topics...":"No chapters available for the selected subjects"})]}):s.map(t=>e.jsx("div",{className:`p-4 rounded-lg border-2 transition-all duration-200 cursor-pointer ${o.includes(t)?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>Me(t),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{checked:o.includes(t),className:"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:t}),e.jsxs("p",{className:"text-sm text-gray-600",children:[_e(c,t).length," topics available"]})]})]})},t))})()})]}),l===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Select Topics"}),e.jsxs("p",{className:"text-gray-600",children:["Choose topics from ",c.join(", ")," - ",o.join(", ")]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(be,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search topics...",value:n,onChange:s=>he(s.target.value),className:"w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),n&&e.jsx("button",{onClick:ue,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(je,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border",children:e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:()=>{const t=E(c,o).map(a=>a.id.toString());d.length===t.length?C([]):C(t)},children:[e.jsx(K,{checked:d.length===E(c,o).length&&E(c,o).length>0,className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Select All Topics"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[E(c,o).length," topics available"]}),e.jsx("span",{className:"text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded",children:ce?"...":`${Object.values(oe).reduce((s,t)=>s+t,0)} total questions`})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:E(c,o).filter(s=>{var t;return!n||s.name.toLowerCase().includes(n.toLowerCase())||((t=s.chapter)==null?void 0:t.toLowerCase().includes(n.toLowerCase()))}).map(s=>e.jsx("div",{className:`p-4 rounded-lg border-2 transition-all duration-200 cursor-pointer ${d.includes(s.id.toString())?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>C(t=>t.includes(s.id.toString())?t.filter(a=>a!==s.id.toString()):[...t,s.id.toString()]),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{checked:d.includes(s.id.toString()),className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:s.chapter}),e.jsx("span",{className:"text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded",children:ce?"...":`${oe[s.id.toString()]||0} questions`})]})]})]})},s.id))})]}),l===4&&e.jsxs("div",{className:"pb-60",children:[e.jsxs("div",{className:"fixed bottom-40 left-0 right-0 z-30 p-4 bg-white border-t",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Number of Questions"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(()=>{const s=[5,10,15,20,25,30,60,90,180];return(q>0&&q<5?[q,...s]:s).map(a=>{const i=q>0?a>q:!0,j=!i&&b===a;return e.jsxs(h,{variant:j?"default":"outline",size:"sm",disabled:i,onClick:()=>{i||ke(a)},className:`text-sm ${i?"opacity-50 cursor-not-allowed line-through":""}`,children:[a," Qs"]},a)})})()}),d.length>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-2 text-center",children:de?"Checking available questions...":q>0?`${q} questions available for selected topics`:"No questions available for selected topics"})]}),e.jsxs("div",{className:"fixed bottom-20 left-0 right-0 z-40 p-4 bg-white border-t",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Time Limit: ",u," minutes"]}),e.jsx(Ce,{value:[u],onValueChange:Ee,min:$,max:P,step:1})]})]}),l===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Review Your Test"}),e.jsx("p",{className:"text-gray-600",children:"Please review your selections before creating the test"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Subject & Chapters"}),e.jsxs("p",{className:"text-gray-600",children:[c.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")," - ",o.join(", ")]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-2",children:["Selected Topics (",d.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(s=>{const t=g.find(a=>a.id.toString()===s);return t?e.jsx($e,{variant:"secondary",className:"text-xs",children:t.name},s):null})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Test Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Questions:"}),e.jsx("span",{className:"font-medium ml-2",children:b})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Time Limit:"}),e.jsxs("span",{className:"font-medium ml-2",children:[u," minutes"]})]})]})]})]})]}),l===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Create Your Test"}),e.jsx("p",{className:"text-gray-600",children:"Ready to start your practice test?"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-green-600 mb-4",children:e.jsx(fe,{className:"h-12 w-12 mx-auto"})}),e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"Test Ready!"}),e.jsxs("p",{className:"text-green-700",children:["Your ",c.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")," test with ",b," questions and ",u," minute time limit is ready to begin."]})]})]})]})})})}),l===1&&e.jsx("div",{className:"fixed bottom-20 left-0 right-0 z-40 bg-white border-t border-gray-200 p-4",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{display:"Physics",value:"physics"},{display:"Chemistry",value:"chemistry"},{display:"Botany",value:"botany"},{display:"Zoology",value:"zoology"}].map(s=>e.jsx("button",{onClick:()=>Pe(s.value),className:`p-3 rounded-lg border-2 transition-all duration-200 cursor-pointer ${c.includes(s.value)?"border-blue-500 bg-blue-50 shadow-sm":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[Oe(s.display),e.jsx("div",{className:"text-left",children:e.jsx("h4",{className:"font-medium text-gray-800 text-sm",children:s.display})})]})},s.value))})})})}),l===2&&e.jsx("div",{className:"fixed bottom-16 left-0 right-0 z-30 bg-white border-t border-gray-200 p-3",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-blue-800 font-medium",children:[o.length," chapter",o.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:xe,className:"text-xs h-7 px-2",children:"Select All"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>L([]),className:"text-xs h-7 px-2",children:"Clear All"})]})]})})})})}),l===3&&e.jsx("div",{className:"fixed bottom-16 left-0 right-0 z-30 bg-white border-t border-gray-200 p-3",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-green-800 font-medium",children:[d.length," topic",d.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>{const t=E(c,o).map(a=>a.id.toString());C(t)},className:"text-xs h-7 px-2",children:"Select All"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>C([]),className:"text-xs h-7 px-2",children:"Clear All"})]})]})})})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(h,{variant:"outline",onClick:Z,disabled:l===1,className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),e.jsx("div",{className:"flex space-x-2",children:l<f?e.jsxs(h,{onClick:p,disabled:l===1&&c.length===0||l===2&&o.length===0||l===3&&d.length===0,className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Next"}),e.jsx(Q,{className:"h-4 w-4 rotate-180"})]}):e.jsx(h,{onClick:Re,disabled:se.isPending,className:"bg-green-600 hover:bg-green-700 flex items-center space-x-2",children:se.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Test"})]})})})]})})})}),e.jsx(Ae,{open:Se,onOpenChange:H,children:e.jsxs(Fe,{className:"sm:max-w-md",children:[e.jsxs(Ue,{children:[e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-orange-500"}),"Insufficient Questions Available"]}),e.jsx(Be,{children:m==null?void 0:m.message})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Available Questions:"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:m==null?void 0:m.available})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Requested Questions:"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:m==null?void 0:m.requested})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium mb-2",children:"What you can do:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Reduce the number of questions to ",m==null?void 0:m.available," or fewer"]}),e.jsx("li",{children:"Select additional topics to get more questions"}),e.jsx("li",{children:"Choose different topics that might have more questions"})]})]})]}),e.jsxs(De,{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",onClick:()=>{H(!1),y(1),w([]),L([]),C([])},className:"flex-1",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Back to Selection"]}),e.jsxs(h,{onClick:()=>{H(!1),m!=null&&m.available&&D(m.available)},className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Use ",m==null?void 0:m.available," Questions"]})]})]})})]})}function ls({testType:v,topics:N,onCancel:l}){const[T,c]=r.useState(20),[w,o]=r.useState(10),[L,d]=r.useState("questions"),C=1,u=r.useMemo(()=>Math.max(1,Math.ceil(T*1.5)),[T]),{toast:I}=Ne(),{student:b}=ve(),[,D]=le(),[Y,k]=r.useState(!1),[p,Z]=r.useState(null);r.useEffect(()=>{w>u&&o(u)},[u,w]);const O=ye({mutationFn:async n=>{const x={...n,studentId:b==null?void 0:b.studentId};return await V(R.ENDPOINTS.TEST_SESSIONS,"POST",x)},onSuccess:n=>D(`/test/${n.session.id}`),onError:n=>{let x=null;try{if(n.message){const z=n.message.match(/^\d+:\s*(.+)$/);z&&(x=JSON.parse(z[1]))}}catch{}(x==null?void 0:x.error)==="Insufficient questions available"?(Z({available:x.available_questions,requested:x.requested_questions,message:x.message||"Not enough questions available for this test configuration."}),k(!0)):I({title:"Error",description:"Failed to create test session. Please try again.",variant:"destructive"})}}),W=()=>{if(!T||T<=0){I({title:"Invalid question count",description:"Please set a valid number of questions for random tests.",variant:"destructive"});return}if(!w||w<=0){I({title:"Invalid time limit",description:"Please set a valid time limit for random tests.",variant:"destructive"});return}const n={selected_topics:[],selection_mode:L==="questions"?"question_count":"time_limit",question_count:T,time_limit:w,test_type:"random"};O.mutate(n)};return e.jsxs("div",{className:"pb-60",children:[v==="random"&&e.jsx(F,{className:"mt-4",children:e.jsx(U,{})}),v==="random"&&e.jsxs("div",{className:"fixed bottom-40 left-0 right-0 z-30 p-4 bg-white border-t",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Number of Questions"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[5,10,15,20,25,30,60,90,180].map(n=>e.jsxs(h,{variant:T===n?"default":"outline",size:"sm",onClick:()=>{c(n),o(n),d("questions")},className:"text-sm",children:[n," Qs"]},n))})]}),v==="random"&&e.jsxs("div",{className:"fixed bottom-20 left-0 right-0 z-40 p-4 bg-white border-t",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Time Limit: ",w," minutes"]}),e.jsx(Ce,{value:[w],onValueChange:n=>{let x=n[0];x<C&&(x=C),x>u&&(x=u),o(x),d("time")},min:C,max:u,step:1})]}),v==="random"&&e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 z-50 p-4 border-t bg-white",style:{paddingBottom:"env(safe-area-inset-bottom, 16px)"},children:e.jsxs("div",{className:"flex flex-row space-x-2 items-center mb-3",children:[e.jsx(h,{variant:"outline",size:"lg",onClick:l,children:"Cancel"}),e.jsx(h,{variant:"default",size:"lg",onClick:W,disabled:O.isPending,className:"w-full",children:O.isPending?"Creating...":"Create Random Test"})]})}),Y&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[99999] bg-white min-h-screen overflow-hidden",children:e.jsxs("div",{className:"max-w-3xl mx-auto h-full flex flex-col",children:[e.jsxs("header",{className:"w-full mx-auto py-3 px-4 border-b border-gray-200 inline-flex items-center gap-3",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"size-8",onClick:()=>k(!1),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Insufficient Questions"})]}),"            ",e.jsx("main",{className:"flex-1 overflow-auto p-4 sm:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Available Questions:"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:p==null?void 0:p.available})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Requested Questions:"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:p==null?void 0:p.requested})]})]}),e.jsx("p",{className:"text-sm text-gray-700",children:"You can reduce the number of questions, or use the available questions to continue the test."})]})}),e.jsx("footer",{className:"p-3 sm:p-6 border-t bg-white",style:{paddingBottom:"env(safe-area-inset-bottom, 16px)"},children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(h,{variant:"outline",onClick:()=>k(!1),className:"w-full",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Back to Selection"]}),e.jsxs(h,{onClick:()=>{p!=null&&p.available&&c(p.available),k(!1)},className:"w-full bg-blue-600 hover:bg-blue-700",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Use ",p==null?void 0:p.available," Questions"]})]})})]})})]})}function ms(){const[v,N]=r.useState(!1),[l,y]=r.useState(!1);return G({queryKey:["/api/dashboard/analytics/"],select:f=>(f==null?void 0:f.totalTests)>0,retry:!1}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-teal-50",children:[e.jsx("header",{className:"sticky top-0 max-w-7xl mx-auto px-4 py-4 border-b bg-white",children:e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Mock Tests & History"})}),e.jsx("div",{className:"max-w-7xl mx-auto px-3",children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4",children:[e.jsx(X,{title:"Quick Random Test",subtitle:"Just choose the no. of questions and get started",icon:e.jsx(We,{className:"w-4 h-4 text-blue-800"}),onClick:()=>N(!0)}),e.jsx(X,{title:"Build Your Own Test",subtitle:"Select subjects, chapters & topics of your choice",icon:e.jsx(Ke,{className:"w-4 h-4 text-blue-800"}),onClick:()=>y(!0)}),e.jsx(X,{title:"Scheduled Tests",subtitle:"Compete with other NEET aspirants and boost your preparation",icon:e.jsx(es,{className:"w-4 h-4 text-blue-800"}),href:"/scheduled-tests"}),e.jsx(X,{title:"Previous Year Questions",subtitle:"Free practice with past year papers get your confidence up",icon:e.jsx(ss,{className:"w-4 h-4 text-blue-800"})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto mt-4 pb-20",children:e.jsx(Xe,{})}),e.jsx(ts,{}),v&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-white h-screen overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("header",{className:"w-full mx-auto py-3 px-4 border-b border-gray-200 inline-flex items-center gap-3",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"size-8",onClick:()=>N(!1),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Create Random Test"})]}),e.jsx("main",{className:"flex-1 overflow-auto p-4",children:e.jsx(ls,{testType:"random",topics:[],onCancel:()=>N(!1)})})]})}),l&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-white h-screen overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("header",{className:"w-full mx-auto py-3 px-4 border-b border-gray-200 inline-flex items-center gap-3",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"size-8",onClick:()=>y(!1),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Build Your Own Test"})]}),e.jsx("main",{className:"flex-1 overflow-auto p-4",children:e.jsx(as,{})})]})})]})}function X({title:v,subtitle:N,icon:l,href:y,onClick:f}){const[,B]=le(),T=()=>{y?B(y):f&&f()};return e.jsx(F,{onClick:T,className:"rounded-2xl shadow-md cursor-pointer",children:e.jsx(U,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsx("div",{className:"flex items-center space-x-2 pr-6",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:v}),e.jsx(Ge,{className:"w-3 h-3 text-gray-700"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:N})]})}),e.jsx("div",{className:"flex items-center pr-2",children:l})]})})})}export{ms as default};
