import{r as l,E as v,aj as k,j as e,t as S,k as d,l as m,ak as D,al as O,am as R,an as q,ao as V,h as T,y as C,ap as Z}from"./main-CzoStkir.js";import{T as G}from"./trophy-CDbnqmnR.js";import{T as I}from"./target-CH9tEfFf.js";function Y(){const[p,A]=l.useState([]),[c,b]=l.useState(null),[i,g]=l.useState(null),[j,u]=l.useState([]),[x,f]=l.useState(!1),[N,h]=l.useState(null),[E,y]=l.useState(!0);l.useEffect(()=>{L()},[]),l.useEffect(()=>{c?F(c):(g(null),u([]))},[c]);const L=async()=>{try{y(!0);const r=`${v.BASE_URL}/api/zone-insights/tests/`,s=await k(r);if(!s.ok)throw new Error(`Failed to fetch test list: ${s.status}`);const a=((await s.json()).tests||[]).map(t=>({id:t.id,test_name:t.test_name||t.testName||"Unnamed Test",test_type:t.test_type||t.testType||"custom",start_time:t.start_time||t.startTime||null,end_time:t.end_time||t.endTime||null,total_marks:t.total_marks??t.totalMarks??0,max_marks:t.max_marks??t.maxMarks??0,total_questions:t.total_questions??t.totalQuestions??0,correct_answers:t.correct_answers??t.correctAnswers??0,incorrect_answers:t.incorrect_answers??t.incorrectAnswers??0,unanswered:t.unanswered??0}));A(a),b(t=>t??(a.length>0?a[0].id:null)),h(null)}catch(r){console.error("Error fetching test list:",r),h("Failed to load test list. Please try refreshing the page.")}finally{y(!1)}},F=async r=>{try{f(!0),h(null);const s=`${v.BASE_URL}/api/zone-insights/test/${r}/`,n=await k(s);if(!n.ok)throw new Error("Failed to fetch checkpoints");const a=await n.json();console.log("API Response:",JSON.stringify(a,null,2)),a.checkpoints&&a.checkpoints.length>0&&(console.log("First checkpoint:",a.checkpoints[0]),a.checkpoints[0].checkpoints&&a.checkpoints[0].checkpoints.length>0&&console.log("First item actionPlan:",a.checkpoints[0].checkpoints[0].actionPlan));const t=a.test_info||a.testInfo||{},B={id:t.id,test_name:t.test_name||t.testName||"Unnamed Test",start_time:t.start_time||t.startTime||null,end_time:t.end_time||t.endTime||null,total_marks:t.total_marks??t.totalMarks??0,max_marks:t.max_marks??t.maxMarks??0,percentage:t.percentage??0,subject_marks:(()=>{const M=t.subject_marks||t.subjectMarks||{},_={};return Object.entries(M).forEach(([z,U])=>{const o=U||{};_[z]={score:o.score??0,correct:o.correct??0,incorrect:o.incorrect??0,unanswered:o.unanswered??0,marks:o.marks??0,max_marks:o.max_marks??o.maxMarks??0}}),_})()};g(B),u(a.checkpoints||[])}catch(s){console.error("Error fetching checkpoints:",s),h("Failed to load checkpoints"),g(null),u([])}finally{f(!1)}},w=r=>{if(!r)return"No Date";try{const s=new Date(r);if(isNaN(s.getTime()))return"Invalid Date";const n=s.getDate().toString().padStart(2,"0"),a=s.toLocaleString("default",{month:"short"}),t=s.getFullYear().toString().slice(-2);return`${n} ${a} ${t}`}catch{return"Invalid Date"}},$=r=>({Physics:"bg-blue-100 text-blue-700 border-blue-300",Chemistry:"bg-green-100 text-green-700 border-green-300",Botany:"bg-emerald-100 text-emerald-700 border-emerald-300",Zoology:"bg-teal-100 text-teal-700 border-teal-300",Math:"bg-purple-100 text-purple-700 border-purple-300",Biology:"bg-lime-100 text-lime-700 border-lime-300"})[r]||"bg-gray-100 text-gray-700 border-gray-300",P=r=>r>=.7?"text-green-600":r>=.5?"text-yellow-600":"text-red-600";return E?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(S,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading tests..."})]}):p.length===0?e.jsx(d,{children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx(G,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Tests Available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Complete a test to see your performance analysis with AI-powered checkpoints."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{children:e.jsxs(m,{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select a Test to Analyze"}),e.jsxs(D,{value:(c==null?void 0:c.toString())||"",onValueChange:r=>b(r?Number(r):null),children:[e.jsx(O,{className:"w-full",children:e.jsx(R,{placeholder:"Choose a test..."})}),e.jsx(q,{children:p.map(r=>{const s=w(r.start_time),n=`${r.total_marks??0}/${r.max_marks??0}`;return e.jsxs(V,{value:r.id.toString(),children:[r.test_name||"Unnamed Test"," - ",s," (",n,")"]},r.id)})})]})]})}),x&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(S,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading insights..."})]}),N&&!x&&e.jsx(d,{className:"border-red-200 bg-red-50",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(T,{className:"h-5 w-5"}),e.jsx("p",{className:"font-medium",children:N})]})})}),i&&!x&&e.jsx(d,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:i.test_name}),e.jsxs(C,{variant:"secondary",className:"bg-white",children:[i.percentage.toFixed(1),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Score"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[i.total_marks," ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["/ ",i.max_marks]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Test Date"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:w(i.start_time)})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:Object.entries(i.subject_marks).filter(([r,s])=>{const n=(s==null?void 0:s.max_marks)??0,a=((s==null?void 0:s.correct)??0)+((s==null?void 0:s.incorrect)??0)+((s==null?void 0:s.unanswered)??0);return n>0||a>0}).map(([r,s])=>e.jsxs("div",{className:"bg-white rounded-lg p-2 border border-blue-100",children:[e.jsx("p",{className:"text-xs text-gray-600",children:r}),e.jsxs("div",{className:"flex items-baseline gap-1 min-w-0 flex-wrap",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.marks}),e.jsxs("p",{className:"text-xs text-gray-500",children:["/ ",s.max_marks]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-50 text-green-800 border border-green-100",children:[e.jsx(Z,{className:"h-3.5 w-3.5 mr-1"}),s.correct??0]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-800 border border-red-100",children:["✕ ",s.incorrect??0]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-50 text-gray-800 border border-gray-100",children:["○ ",s.unanswered??0]})]})]})]},r))})]})}),j.length>0&&!x&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 px-1",children:"Subject-Wise Performance Checkpoints"}),j.map(r=>e.jsxs(d,{className:"overflow-hidden",children:[e.jsx("div",{className:`${$(r.subject)} border-b-2 px-4 py-2`,children:e.jsx("h4",{className:"font-bold text-lg",children:r.subject})}),e.jsx(m,{className:"p-4 space-y-4",children:r.checkpoints.map((s,n)=>e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900",children:s.topic}),e.jsx("p",{className:"text-xs text-gray-600",children:s.subtopic})]}),e.jsxs(C,{variant:"outline",className:`${P(s.accuracy)} border-current`,children:[(s.accuracy*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"mb-3 p-3 bg-red-50 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-semibold text-red-800 mb-1",children:"Problem Identified:"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.checklist})]})]})}),e.jsx("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-green-800 mb-1",children:"Action Plan:"}),e.jsx("p",{className:"text-sm text-gray-900 leading-relaxed whitespace-normal break-words",children:s.actionPlan})]})]})}),s.citation&&s.citation.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Based on questions: ",s.citation.join(", ")]})]},n))})]},r.subject))]}),!c&&!x&&e.jsx(d,{children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx(I,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select a Test to Begin"}),e.jsx("p",{className:"text-gray-600",children:"Choose a test from the dropdown above to see detailed performance checkpoints with AI-powered recommendations."})]})})]})}export{Y as T};
