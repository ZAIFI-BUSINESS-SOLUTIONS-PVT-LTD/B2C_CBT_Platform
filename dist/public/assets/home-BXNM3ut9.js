import{r as n,j as e,T as F,a as Y,b as G,I as K,c as V,u as Z,d as X,e as H,f as R,L as U,B as T,C as J,g as _,G as W,F as ee,h as se,i as B,k as te,l as ae,M as ne}from"./main-CzoStkir.js";import{S as re}from"./profile-avatar-D9cO9Vj4.js";import{M as le}from"./mobile-dock-BiP46c2r.js";import{T as ie,C as oe}from"./timer-BF0kR2mK.js";import{T as ce}from"./trophy-CDbnqmnR.js";import{C as de}from"./clipboard-list-hnW4UgXJ.js";import"./notepad-text-7swJf2ST.js";const w=({icon:r,label:l,value:i,badge:t,info:d,className:x="",style:v={},iconBgClass:p="bg-gray-100"})=>{const[m,h]=n.useState(!1),f=n.useRef(null);return n.useEffect(()=>{const o=b=>{f.current&&!f.current.contains(b.target)&&h(!1)},y=b=>{b.key==="Escape"&&h(!1)};return m&&(document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),document.addEventListener("keydown",y)),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o),document.removeEventListener("keydown",y)}},[m]),e.jsxs("div",{className:`card rounded-xl shadow-md bg-white flex flex-col justify-between w-48 h-28 ${x} px-3 py-2 mb-1`,style:{...v},children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:`inline-flex items-center justify-center w-8 h-8 rounded-lg ${p} text-[1rem] p-1.5`,children:r})}),e.jsx("span",{className:"block text-gray-500 text-xs font-medium mb-1 text-left",children:e.jsxs("span",{className:"inline-flex items-center",children:[l,d&&e.jsx("span",{ref:f,style:{position:"relative",display:"inline-block",marginLeft:"4px",top:"-0.5em"},children:e.jsx(F,{children:e.jsxs(Y,{open:m,children:[e.jsx(G,{asChild:!0,children:e.jsx("button",{onClick:o=>{o.stopPropagation(),h(!m)},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),o.stopPropagation(),h(!m))},className:"inline-block text-gray-400 hover:text-primary cursor-pointer rounded p-0.5 focus:outline-none","aria-label":`Info about ${l}`,"aria-expanded":m,children:e.jsx(K,{size:12})})}),e.jsx(V,{children:e.jsx("p",{className:"max-w-xs",children:d})})]})})})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xl font-extrabold text-gray-900 tracking-tight flex-1 text-left",children:i}),t&&e.jsx("span",{className:"ml-1",children:t})]})]})},g=r=>{if(!r)return"just now";try{const l=new Date(r);if(isNaN(l.getTime()))return"just now";const t=Math.floor((new Date().getTime()-l.getTime())/1e3);return t<0||t<60?"just now":t<3600?`${Math.floor(t/60)} minute${Math.floor(t/60)===1?"":"s"} ago`:t<86400?`${Math.floor(t/3600)} hour${Math.floor(t/3600)===1?"":"s"} ago`:t<604800?`${Math.floor(t/86400)} day${Math.floor(t/86400)===1?"":"s"} ago`:t<2592e3?`${Math.floor(t/604800)} week${Math.floor(t/604800)===1?"":"s"} ago`:t<31536e3?`${Math.floor(t/2592e3)} month${Math.floor(t/2592e3)===1?"":"s"} ago`:`${Math.floor(t/31536e3)} year${Math.floor(t/31536e3)===1?"":"s"} ago`}catch(l){return console.warn("Error parsing date for relative time:",r,l),"just now"}},xe=()=>{const r=new Date;console.log("Testing formatRelativeTime function:"),console.log("Just now:",g(r.toISOString())),console.log("5 minutes ago:",g(new Date(r.getTime()-5*60*1e3).toISOString())),console.log("2 hours ago:",g(new Date(r.getTime()-2*60*60*1e3).toISOString())),console.log("1 day ago:",g(new Date(r.getTime()-24*60*60*1e3).toISOString())),console.log("Invalid date:",g("invalid-date")),console.log("Null:",g(null))},k={container:"p-3 rounded-xl",text:"text-sm",variants:{blue:{container:"bg-gray-200",text:"text-gray-700",accent:"text-blue-600",accentBg:"bg-blue-50"},indigo:{container:"bg-gray-200",text:"text-gray-700",accent:"text-indigo-600",accentBg:"bg-indigo-50"},green:{container:"bg-gray-200",text:"text-gray-700",accent:"text-green-600",accentBg:"bg-green-50"},red:{container:"bg-gray-200",text:"text-gray-700",accent:"text-red-600",accentBg:"bg-red-50"},gray:{container:"bg-gray-200",text:"text-gray-700",accent:"text-gray-600",accentBg:"bg-gray-50"}}},j=({children:r,variant:l,className:i=""})=>{const t=k.variants[l];return e.jsx("div",{className:`${k.container} ${t.container} ${i}`,children:e.jsx("div",{className:`${k.text} ${t.text}`,children:r})})};function ve(){var S,I,M,$,E,A,L,D;const{isAuthenticated:r,loading:l,student:i}=Z(),[,t]=X();H();const d=!!(i!=null&&i.institution);n.useEffect(()=>{console.log("ðŸ« Institution check:",{student:i,hasInstitution:d,institutionData:i==null?void 0:i.institution})},[i,d]);const[x,v]=n.useState(0),[p,m]=n.useState(null),[h,f]=n.useState(null);n.useState(!1);const o=n.useRef(null),y=n.useRef(null),b=n.useCallback(()=>{v(s=>(s+1)%4)},[]),C=n.useCallback(()=>{v(s=>(s-1+4)%4)},[]),O=n.useCallback(s=>{f(null),m({x:s.targetTouches[0].clientX,y:s.targetTouches[0].clientY})},[]),z=n.useCallback(s=>{f({x:s.targetTouches[0].clientX,y:s.targetTouches[0].clientY})},[]),P=n.useCallback(()=>{if(!p||!h)return;const s=p.x-h.x,u=p.y-h.y,N=s>50,q=s<-50;Math.abs(u)>Math.abs(s)||(N?b():q&&C())},[p,h,b,C]),{data:c}=R({queryKey:["/api/dashboard/comprehensive-analytics/"],refetchInterval:3e4,enabled:r&&!l}),{data:a}=R({queryKey:["/api/insights/student/"],refetchInterval:3e4,enabled:r&&!l});if(n.useEffect(()=>{if(y.current){const s=y.current.querySelector(`[data-tab-id="${x}"]`);s&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}},[x]),n.useEffect(()=>{var s;xe(),a&&(console.log("Insights data:",a),console.log("Cache info:",a.cacheInfo),(s=a.cacheInfo)!=null&&s.lastModified&&(console.log("Last modified:",a.cacheInfo.lastModified),console.log("Formatted time:",g(a.cacheInfo.lastModified))))},[a]),!r)return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-indigo-50 to-indigo-50",children:e.jsx("div",{className:"text-center text-sm text-gray-600",children:"Checking authentication..."})}):(t("/login"),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-indigo-50 to-indigo-50",children:e.jsx("div",{className:"text-center text-sm text-gray-600",children:"Redirecting to login..."})}));const Q=c&&c.totalTests>0;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("header",{className:"w-full bg-white border-b sticky top-0 z-50",children:e.jsx("div",{className:"w-full mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("img",{src:U,alt:"InzightEd",className:"h-6 w-auto"}),d&&e.jsx("span",{className:"text-xs bg-red-500 text-white px-2 py-1 rounded",children:"INSTITUTION"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>t("/payment"),className:"aspect-square bg-orange-100 rounded-full h-10 w-10","aria-label":"Go to Payment",children:e.jsx(J,{className:"h-5 w-5 text-amber-600"})}),e.jsx(re,{})]})]})})}),e.jsxs("div",{className:"w-full bg-gray-100 relative",children:[d&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/60 backdrop-blur-sm min-h-screen",children:e.jsx("div",{className:"bg-white p-8 rounded-2xl shadow-2xl border-2 border-gray-300 max-w-md mx-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full",children:e.jsx(_,{className:"h-16 w-16 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl text-gray-900 mb-2"}),e.jsx("p",{className:"text-base text-gray-600 leading-relaxed",children:"This feature is not available for institution-enrolled students. Please access your institution-specific tests and resources."})]})]})})}),e.jsxs("div",{className:d?"blur-lg pointer-events-none select-none":"","aria-hidden":d,children:[e.jsx("div",{className:"w-full px-3 py-2 bg-gradient-to-br from-slate-100 to-white",children:e.jsx("div",{className:"w-full overflow-x-auto hide-scrollbar",children:e.jsxs("div",{className:"flex gap-3 snap-x snap-mandatory items-center",children:[e.jsx("div",{className:"flex-shrink-0 snap-center p-1",children:e.jsx(w,{icon:e.jsx(W,{className:"w-5 h-5 text-green-600"}),iconBgClass:"bg-green-50 border border-green-100",label:"Your Average Score",value:c?`${Math.round(c.overallAccuracy??0)}%`:"0%",info:"Percentage score across all tests taken",className:"p-2"})}),e.jsx("div",{className:"flex-shrink-0 snap-center p-1",children:e.jsx(w,{icon:e.jsx(ie,{className:"w-5 h-5 text-orange-600"}),iconBgClass:"bg-orange-50 border border-orange-100",label:"Avg. Speed /Question",value:c?`${Math.round(c.averageTimePerQuestion??0)} sec.`:"0 sec.",info:"Average time spent per question",className:"p-2"})}),e.jsx("div",{className:"flex-shrink-0 snap-center p-1",children:e.jsx(w,{icon:e.jsx(oe,{className:"w-5 h-5 text-blue-600"}),iconBgClass:"bg-blue-50 border border-blue-100",label:"Questions attended",value:c?`${c.uniqueQuestionsAttempted??0}`:"0",info:"Total number of questions attempted",className:"p-2"})}),e.jsx("div",{className:"flex-shrink-0 snap-center p-1",children:e.jsx(w,{icon:e.jsx(ee,{className:"w-5 h-5 text-purple-600"}),iconBgClass:"bg-purple-50 border border-purple-100",label:"Tests attended",value:c?`${c.totalTests??0}`:"0",info:"Total number of tests completed",className:"p-2"})})]})})}),e.jsxs("div",{className:"pb-20 bg-white rounded-t-3xl w-full shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1),0_10px_15px_-3px_rgba(0,0,0,0.1),0_4px_6px_-2px_rgba(0,0,0,0.05)]",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 pt-4",children:e.jsx("div",{className:"flex space-x-3",children:[{id:0,label:"Focus Zone",icon:se,key:"yetToDecide"},{id:1,label:"Steady Zone",icon:ce,key:"keyStrengths"}].map(s=>{const u=x===s.id;let N="";return u&&(s.key==="keyStrengths"?N="bg-green-100 text-green-900 shadow-sm shadow-green-200/50 border border-green-300":s.key==="yetToDecide"&&(N="bg-orange-100 text-orange-900 shadow-sm shadow-orange-200/60 border border-orange-300")),e.jsx("button",{onClick:()=>v(s.id),className:`flex-1 py-2 px-2 text-sm font-semibold rounded-xl transition-all duration-300 ease-out transform scale-[1.02] ${u?N:"text-gray-600 hover:text-gray-900 hover:bg-white/50 active:scale-95"}`,children:s.label},s.id)})})}),e.jsx("div",{className:"select-none insights-container relative bg-white",children:e.jsx("div",{ref:o,onTouchStart:O,onTouchMove:z,onTouchEnd:P,className:"overflow-hidden",children:e.jsx("div",{className:"p-4 min-h-[120px]",children:Q?e.jsxs(e.Fragment,{children:[x===0&&e.jsx("div",{className:"space-y-2",children:(M=(I=(S=a==null?void 0:a.data)==null?void 0:S.llmInsights)==null?void 0:I.weaknesses)!=null&&M.insights?e.jsx("div",{className:"space-y-2",children:a.data.llmInsights.weaknesses.insights.length>0&&(()=>{const s=a.data.llmInsights.weaknesses.insights[0];return e.jsx(j,{variant:"red",children:(s==null?void 0:s.text)??s},(s==null?void 0:s.id)??s)})()}):($=a==null?void 0:a.data)!=null&&$.weakTopics&&a.data.weakTopics.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-700 mb-2",children:"Topics needing focus:"}),e.jsx("ul",{className:"space-y-1 text-xs",children:a.data.weakTopics.slice(0,3).map((s,u)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.topic}),e.jsxs("span",{className:"text-red-600",children:[s.accuracy,"%"]})]},u))})]}):e.jsx("div",{className:"space-y-2",children:e.jsx(j,{variant:"red",children:"Take some tests to get AI analysis of your weaknesses!"})})}),x===1&&e.jsx("div",{className:"space-y-2",children:!c||c.totalTests===0?e.jsx("div",{className:"space-y-2",children:e.jsx(j,{variant:"gray",children:"Complete practice tests to unlock your strengths!"})}):(L=(A=(E=a==null?void 0:a.data)==null?void 0:E.llmInsights)==null?void 0:A.strengths)!=null&&L.insights?e.jsx("div",{className:"space-y-2",children:a.data.llmInsights.strengths.insights.length>0&&(()=>{const s=a.data.llmInsights.strengths.insights[0];return e.jsx(j,{variant:"green",children:(s==null?void 0:s.text)??s},(s==null?void 0:s.id)??s)})()}):(D=a==null?void 0:a.data)!=null&&D.strengthTopics&&a.data.strengthTopics.length>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-700 mb-2",children:"Your top performing topics:"}),e.jsx("ul",{className:"space-y-1 text-xs",children:a.data.strengthTopics.slice(0,3).map((s,u)=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.topic}),e.jsxs("span",{className:"text-green-600",children:[s.accuracy,"%"]})]},u))})]}):e.jsx("div",{className:"space-y-2",children:e.jsx(j,{variant:"green",children:"Take some tests to get AI analysis of your strengths!"})})})]}):e.jsx("div",{className:"space-y-3",children:e.jsx(j,{variant:x===0?"red":x===1?"blue":"green",children:e.jsxs("div",{className:"flex flex-col  justify-center items-center gap-3",children:[e.jsx("div",{children:e.jsx(_,{className:"h-16 w-16 text-gray-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold",children:"Get personalized insights"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Take your first practice test to unlock AI-powered Focus Zone and Steady Zone analysis."})]}),e.jsx("div",{className:"flex",children:e.jsx(T,{variant:"default",size:"lg",onClick:()=>t("/topics"),className:"w-full rounded-lg font-bold","aria-label":"Take a Test",children:"Take Unlimited Mock Tests"})})]})})})})})}),e.jsx("div",{className:"px-4 pb-6",children:e.jsxs(T,{variant:"default",size:"lg",onClick:()=>t("/dashboard"),className:"w-full px-4 bg-gradient-to-b from-gray-600 to-gray-800 text-white rounded-xl font-semibold flex","aria-label":"View more AI generated tips",children:["Results and more AI generated tips",e.jsx(B,{className:"h-4 w-4 ml-2"})]})})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-100 to-transparent"})}),e.jsxs("div",{className:"px-4 pb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Take your tests to grow"}),e.jsx("div",{className:"space-y-3",children:e.jsx(te,{onClick:()=>t("/topics"),className:"rounded-2xl border-2 border-blue-200",children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1 group",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Select your test"}),e.jsx(B,{className:"w-4 h-4 text-gray-700 transition-transform duration-200 group-hover:translate-x-0.5"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Scheduled Tests â€¢ Quick Tests â€¢ Build Your Own Tests and more"})]}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"p-2 rounded-xl bg-blue-50 border border-blue-100",children:e.jsx(de,{className:"w-6 h-6 text-blue-600"})})})]})})})})]}),e.jsx("div",{className:"px-4 pb-6",children:e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"})}),e.jsxs("div",{className:"px-4 pb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Learn how to improve with your own assisstant"}),e.jsx(ne,{className:"max-w-full"})]})]})]})]}),e.jsx(le,{})]})}export{ve as default};
