import{r as i,d as te,D as be,f as J,u as ve,E as U,H as W,J as ye,j as e,k as _,w as fe,K as se,l as R,x as Ae,X as je,N as X,B as h,y as ze,P as Ce,Z as Fe,_ as Ue,$ as De,a0 as Be,a1 as He,a2 as Ge,O as V,Q as Je,R as Ye,U as Ke,V as Xe,i as Ve}from"./main-CzoStkir.js";import{S as Ne,a as we,L as Ze,b as We,c as es,C as ss}from"./slider-Did0NyCC.js";import{H as ts}from"./header-desktop-BFuvCPr5.js";import{C as as}from"./clipboard-list-hnW4UgXJ.js";import{T as ls}from"./trophy-CDbnqmnR.js";import"./profile-avatar-D9cO9Vj4.js";import"./scroll-area-WtX7C85G.js";import"./notepad-text-7swJf2ST.js";const is=i.forwardRef(({onInsufficientQuestions:y,onNext:I,onPrev:O,canGoNext:C,canGoPrev:M,isLastStep:L,isCreating:g,currentStep:c,onStepChange:j},p)=>{var pe;const[,w]=te(),{toast:o}=be(),[$,E]=i.useState(1),x=c??$,S=6,[k,D]=i.useState("custom"),[r,Q]=i.useState([]),[l,m]=i.useState([]),[d,B]=i.useState([]),[b,Y]=i.useState(60),[q,Se]=i.useState(20),[ae,le]=i.useState("questions");i.useImperativeHandle(p,()=>({handleCreateTest:$e}));const[Te,Le]=i.useState([]);i.useState([]);const[N,ie]=i.useState(""),[rs,ne]=i.useState(!1),{data:A,isLoading:re,error:ce}=J({queryKey:["allTopics"],queryFn:async()=>{let s=[],t=`${U.BASE_URL}${U.ENDPOINTS.TOPICS}`;for(console.log("ðŸ”„ Starting to fetch all topics...");t;){console.log("ðŸ“¡ Fetching page:",t);const a=await fetch(t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status} for URL: ${t}`);const n=await a.json();console.log(`âœ… Fetched ${n.results.length} topics from this page. Total so far: ${s.length+n.results.length}`),s=s.concat(n.results),t=n.next}return console.log(`ðŸŽ‰ Finished fetching all topics. Total: ${s.length}`),{results:s,count:s.length}}});console.log("ðŸ“Š Topics query state:",{isLoading:re,error:ce,totalTopics:(pe=A==null?void 0:A.results)==null?void 0:pe.length});const u=(A==null?void 0:A.results)||[];i.useEffect(()=>{if(u.length>0){const s=[...new Set(u.map(a=>a.subject))],t=[...new Set(u.map(a=>`${a.subject}-${a.chapter}`))].length;console.log("ðŸ“š Topics loaded:",{totalTopics:u.length,subjects:s,totalChapters:t,sampleTopics:u.slice(0,3)}),s.forEach(a=>{const n=u.filter(v=>v.subject===a),f=[...new Set(n.map(v=>v.chapter))];console.log(`ðŸ“– ${a}: ${n.length} topics, ${f.length} chapters`,f)}),console.log("ðŸ”¬ Raw topic sample:",JSON.stringify(u.slice(0,2),null,2))}},[u]);const{student:ee}=ve(),{data:ke,isLoading:oe}=J({queryKey:["topicQuestionCounts",r,l,c],queryFn:async()=>{if(c!==3||r.length===0||l.length===0)return{};const t=P(r,l).map(F=>F.id);if(t.length===0)return{};const a=new URLSearchParams;t.forEach(F=>a.append("topic_ids",String(F)));const n=`${U.ENDPOINTS.TOPIC_QUESTION_COUNTS}?${a.toString()}`;console.log("ðŸ“¡ Fetching exact question counts:",n);const f=await W(n,"GET"),v=(f==null?void 0:f.counts)||{};return console.log("âœ… Received exact topic counts:",v),v},enabled:c===3&&r.length>0&&l.length>0,staleTime:1e3*60*5,gcTime:1e3*60*10}),de=ke||{},{data:K,isLoading:me,error:cs}=J({queryKey:["availableQuestions",d],queryFn:async()=>{if(d.length===0)return{available:0};const s=new URLSearchParams;d.forEach(v=>s.append("topic_ids",String(v)));const t=`${U.ENDPOINTS.TOPIC_QUESTION_COUNTS}?${s.toString()}`;console.log("ðŸ“¡ Fetching total available questions for selected topics:",t);const a=await W(t,"GET"),n=(a==null?void 0:a.counts)||{},f=Object.values(n).reduce((v,F)=>v+(typeof F=="number"?F:0),0);return console.log("âœ… Total available questions for selected topics:",f),{available:f}},enabled:d.length>0&&c===4,staleTime:1e3*60*5,gcTime:1e3*60*10}),T=(K==null?void 0:K.available)??0,qe=d.length>0&&c===4;console.log("ðŸ”§ Query debug:",{selectedTopicsCount:d.length,currentStep:c,shouldQueryRun:qe,isLoading:me,hasData:!!K,availableQuestions:T}),console.log("ðŸŽ¯ Available questions:",T,"Query enabled:",d.length>0&&c===4);const Ie=ye({mutationFn:async s=>{const t={...s,studentId:ee==null?void 0:ee.studentId};return await W(U.ENDPOINTS.TEST_SESSIONS,"POST",t)},onSuccess:s=>{w(`/test/${s.session.id}`)},onError:s=>{console.log("âŒ Test creation failed in mutation:",s.message),console.log("âŒ Full error object:",s),console.log("âŒ Error details:",s.details);let t=null;try{if(s.message){const a=s.message.match(/^\d+:\s*(.+)$/);a&&(t=JSON.parse(a[1]))}if(!t&&s.details)if(typeof s.details=="string")try{t=JSON.parse(s.details)}catch{console.log("âŒ Could not parse error.details as JSON")}else typeof s.details=="object"&&(t=s.details);console.log("ðŸ” Final error data:",t)}catch{console.error("Error parsing mutation error:",s.message)}(t==null?void 0:t.error)==="Insufficient questions available"?y&&y({available:t.available_questions,requested:t.requested_questions,message:t.message||"Not enough questions available for this test configuration."}):o({title:"Failed to create test",description:"Could not create test session.",variant:"destructive"})}});i.useEffect(()=>{u.length>0&&Te.length===0&&Le([])},[u]);const xe=1,Ee=1.5,H=xe,z=i.useMemo(()=>Math.max(xe,Math.ceil(q*Ee)),[q]);i.useEffect(()=>{b>z&&Y(z),b<H&&Y(H)},[z,b]);const Pe=s=>{Se(s),Y(s),le("questions")},_e=s=>{let t=s[0];t<H&&(t=H),t>z&&(t=z),Y(t),le("time")},G=s=>{if(s.length===0)return[];const t=u.filter(n=>s.some(f=>n.subject&&n.subject.toLowerCase()===f.toLowerCase()));return[...new Set(t.map(n=>n.chapter).filter(n=>n!=null&&typeof n=="string"&&n.trim()!==""))]},Re=(s,t)=>s.length===0||!t?[]:u.filter(a=>s.some(n=>a.subject&&a.subject.toLowerCase()===n.toLowerCase())&&a.chapter===t),P=(s,t)=>s.length===0||t.length===0?[]:u.filter(a=>s.some(n=>a.subject&&a.subject.toLowerCase()===n.toLowerCase())&&a.chapter&&t.includes(a.chapter)),Oe=s=>{Q(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s]),m([])},Me=s=>{m(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},he=()=>{const s=G(r);l.length===s.length?m([]):m(s)},$e=()=>{const s=d;if(s.length===0){o({title:"No topics selected",description:"Please select at least one topic for your test.",variant:"destructive"});return}if(ae==="questions"){if(!q||q<=0){o({title:"Invalid question count",description:"Please set a valid number of questions.",variant:"destructive"});return}}else if(!b||b<=0){o({title:"Invalid time limit",description:"Please set a valid time limit.",variant:"destructive"});return}const t=ae==="questions"?"question_count":"time_limit",a={selected_topics:s,selection_mode:t,test_type:k};t==="question_count"?a.question_count=q:a.time_limit=b,console.log("ðŸš€ Creating custom test with payload:",a),Ie.mutate(a)},Qe=s=>{switch(s){case"Physics":return e.jsx(De,{className:"h-6 w-6 text-blue-600"});case"Chemistry":return e.jsx(Ue,{className:"h-6 w-6 text-green-600"});case"Botany":return e.jsx(We,{className:"h-6 w-6 text-emerald-600"});case"Zoology":return e.jsx(Fe,{className:"h-6 w-6 text-purple-600"});default:return e.jsx(Ze,{className:"h-6 w-6 text-gray-600"})}};u.filter(s=>{if(!N)return!1;const t=N.toLowerCase();return s.name.toLowerCase().includes(t)||s.subject.toLowerCase().includes(t)||s.chapter&&s.chapter.toLowerCase().includes(t)});const ue=s=>{ie(s),ne(s.length>0)},ge=()=>{ie(""),ne(!1)};return re?e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(_,{className:"shadow-xl",children:[e.jsxs(fe,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:[e.jsx(se,{className:"h-8 w-64"}),e.jsx(se,{className:"h-4 w-96"})]}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(s=>e.jsx(se,{className:"h-32 w-full"},s))})})]})})})}):ce?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs(_,{className:"max-w-md",children:[e.jsx(fe,{children:e.jsx(Ae,{className:"text-red-600",children:"Error Loading Topics"})}),e.jsx(R,{children:e.jsx("p",{className:"text-gray-600",children:"Failed to load topics. Please try refreshing the page."})})]})}):e.jsxs("div",{className:"relative h-full flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Step ",x," of ",S]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[x===1&&"Select Subjects",x===2&&"Select Chapters",x===3&&"Select Topics",x===4&&"Configure Test",x===5&&"Review Test",x===6&&"Create Test"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${x/S*100}%`}})})]}),e.jsx("div",{className:"p-4 pb-32",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(_,{children:e.jsxs(R,{className:"px-2 pb-4",children:[c===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Select Chapters"}),e.jsxs("p",{className:"text-gray-600",children:["Choose one or more chapters from ",r.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ne,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search chapters...",value:N,onChange:s=>ue(s.target.value),className:"w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),N&&e.jsx("button",{onClick:ge,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(je,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border",children:e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:he,children:[e.jsx(X,{checked:l.length===G(r).length&&G(r).length>0,className:"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Select All Chapters"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[G(r).length," chapters available"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:(()=>{const s=G(r).filter(t=>!N||t.toLowerCase().includes(N.toLowerCase()));return s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"No chapters found"}),e.jsx("p",{className:"text-sm",children:r.length===0?"Please select at least one subject first":u.length===0?"Loading topics...":"No chapters available for the selected subjects"})]}):s.map(t=>e.jsx("div",{className:`p-4 rounded-lg border-2 transition-all duration-200 cursor-pointer ${l.includes(t)?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>Me(t),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{checked:l.includes(t),className:"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:t}),e.jsxs("p",{className:"text-sm text-gray-600",children:[Re(r,t).length," topics available"]})]})]})},t))})()})]}),c===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-start",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Select Topics"}),e.jsxs("p",{className:"text-gray-600",children:["Choose topics from ",r.join(", ")," - ",l.join(", ")]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ne,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search topics...",value:N,onChange:s=>ue(s.target.value),className:"w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),N&&e.jsx("button",{onClick:ge,className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(je,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border",children:e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:()=>{const t=P(r,l).map(a=>a.id.toString());d.length===t.length?B([]):B(t)},children:[e.jsx(X,{checked:d.length===P(r,l).length&&P(r,l).length>0,className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Select All Topics"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[P(r,l).length," topics available"]}),e.jsx("span",{className:"text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded",children:oe?"...":`${Object.values(de).reduce((s,t)=>s+t,0)} total questions`})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:P(r,l).filter(s=>{var t;return!N||s.name.toLowerCase().includes(N.toLowerCase())||((t=s.chapter)==null?void 0:t.toLowerCase().includes(N.toLowerCase()))}).map(s=>e.jsx("div",{className:`p-4 rounded-lg border-2 transition-all duration-200 cursor-pointer ${d.includes(s.id.toString())?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>B(t=>t.includes(s.id.toString())?t.filter(a=>a!==s.id.toString()):[...t,s.id.toString()]),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{checked:d.includes(s.id.toString()),className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:s.chapter}),e.jsx("span",{className:"text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded",children:oe?"...":`${de[s.id.toString()]||0} questions`})]})]})]})},s.id))})]}),c===4&&e.jsxs("div",{className:"pb-60",children:[e.jsxs("div",{className:"absolute bottom-40 left-0 right-0 z-30 p-4 bg-white border-t",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Number of Questions"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(()=>{const s=[5,10,15,20,25,30,60,90,180];return(T>0&&T<5?[T,...s]:s).map(a=>{const n=T>0?a>T:!0,f=!n&&q===a;return e.jsxs(h,{variant:f?"default":"outline",size:"sm",disabled:n,onClick:()=>{n||Pe(a)},className:`text-sm ${n?"opacity-50 cursor-not-allowed line-through":""}`,children:[a," Qs"]},a)})})()}),d.length>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-2 text-center",children:me?"Checking available questions...":T>0?`${T} questions available for selected topics`:"No questions available for selected topics"})]}),e.jsxs("div",{className:"absolute bottom-20 left-0 right-0 z-40 p-4 bg-white border-t",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Time Limit: ",b," minutes"]}),e.jsx(we,{value:[b],onValueChange:_e,min:H,max:z,step:1})]})]}),c===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Review Your Test"}),e.jsx("p",{className:"text-gray-600",children:"Please review your selections before creating the test"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Subject & Chapters"}),e.jsxs("p",{className:"text-gray-600",children:[r.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")," - ",l.join(", ")]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-2",children:["Selected Topics (",d.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(s=>{const t=u.find(a=>a.id.toString()===s);return t?e.jsx(ze,{variant:"secondary",className:"text-xs",children:t.name},s):null})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Test Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Questions:"}),e.jsx("span",{className:"font-medium ml-2",children:q})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Time Limit:"}),e.jsxs("span",{className:"font-medium ml-2",children:[b," minutes"]})]})]})]})]})]}),c===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Create Your Test"}),e.jsx("p",{className:"text-gray-600",children:"Ready to start your practice test?"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-green-600 mb-4",children:e.jsx(Ce,{className:"h-12 w-12 mx-auto"})}),e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"Test Ready!"}),e.jsxs("p",{className:"text-green-700",children:["Your ",r.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")," test with ",q," questions and ",b," minute time limit is ready to begin."]})]})]})]})})})}),c===1&&e.jsx("div",{className:"absolute bottom-20 left-0 right-0 z-40 bg-white border-t border-gray-200 p-4",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{display:"Physics",value:"physics"},{display:"Chemistry",value:"chemistry"},{display:"Botany",value:"botany"},{display:"Zoology",value:"zoology"}].map(s=>e.jsx("button",{onClick:()=>Oe(s.value),className:`p-3 rounded-lg border-2 transition-all duration-200 cursor-pointer ${r.includes(s.value)?"border-blue-500 bg-blue-50 shadow-sm":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[Qe(s.display),e.jsx("div",{className:"text-left",children:e.jsx("h4",{className:"font-medium text-gray-800 text-sm",children:s.display})})]})},s.value))})})})}),c===2&&e.jsx("div",{className:"absolute bottom-16 left-0 right-0 z-30 bg-white border-t border-gray-200 p-3",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-blue-800 font-medium",children:[l.length," chapter",l.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:he,className:"text-xs h-7 px-2",children:"Select All"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>m([]),className:"text-xs h-7 px-2",children:"Clear All"})]})]})})})})}),c===3&&e.jsx("div",{className:"absolute bottom-16 left-0 right-0 z-30 bg-white border-t border-gray-200 p-3",children:e.jsx("div",{className:"container mx-auto px-2.5",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-green-800 font-medium",children:[d.length," topic",d.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>{const t=P(r,l).map(a=>a.id.toString());B(t)},className:"text-xs h-7 px-2",children:"Select All"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>B([]),className:"text-xs h-7 px-2",children:"Clear All"})]})]})})})})})]})});function ns({testType:y,topics:I,onCancel:O,onInsufficientQuestions:C}){const[c,j]=i.useState(20),[p,w]=i.useState(10),[o,$]=i.useState("questions"),E=1,x=i.useMemo(()=>Math.max(1,Math.ceil(c*1.5)),[c]),{toast:S}=be(),{student:k}=ve(),[,D]=te();i.useEffect(()=>{p>x&&w(x)},[x,p]);const r=ye({mutationFn:async l=>{const m={...l,studentId:k==null?void 0:k.studentId};return await W(U.ENDPOINTS.TEST_SESSIONS,"POST",m)},onSuccess:l=>D(`/test/${l.session.id}`),onError:l=>{let m=null;try{if(l.message){const d=l.message.match(/^\d+:\s*(.+)$/);d&&(m=JSON.parse(d[1]))}}catch{}(m==null?void 0:m.error)==="Insufficient questions available"?C&&C({available:m.available_questions,requested:m.requested_questions,message:m.message||"Not enough questions available for this test configuration."}):S({title:"Error",description:"Failed to create test session. Please try again.",variant:"destructive"})}}),Q=()=>{if(!c||c<=0){S({title:"Invalid question count",description:"Please set a valid number of questions for random tests.",variant:"destructive"});return}if(!p||p<=0){S({title:"Invalid time limit",description:"Please set a valid time limit for random tests.",variant:"destructive"});return}const l={selected_topics:[],selection_mode:o==="questions"?"question_count":"time_limit",question_count:c,time_limit:p,test_type:"random"};r.mutate(l)};return e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"space-y-6",children:y==="random"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3",children:"Number of Questions"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[5,10,15,20,25,30,60,90,180].map(l=>e.jsxs(h,{variant:c===l?"default":"outline",size:"sm",onClick:()=>{j(l),w(l),$("questions")},className:"text-sm",children:[l," Qs"]},l))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-2",children:["Time Limit: ",p," minutes"]}),e.jsx(we,{value:[p],onValueChange:l=>{let m=l[0];m<E&&(m=E),m>x&&(m=x),w(m),$("time")},min:E,max:x,step:1})]}),e.jsxs("div",{className:"flex flex-row space-x-2 items-center pt-4",children:[e.jsx(h,{variant:"outline",size:"lg",onClick:O,children:"Cancel"}),e.jsx(h,{variant:"default",size:"lg",onClick:Q,disabled:r.isPending,className:"flex-1",children:r.isPending?"Creating...":"Create Random Test"})]})]})})})}function fs(){var Q;const[y,I]=i.useState(!1),[O,C]=i.useState(!1),[M,L]=i.useState(!1),[g,c]=i.useState(null),[j,p]=i.useState(1);i.useState([]),i.useState([]),i.useState([]);const w=i.useRef(null);J({queryKey:["/api/dashboard/analytics/"],select:l=>(l==null?void 0:l.totalTests)>0,retry:!1});const{data:o}=J({queryKey:["/api/dashboard/comprehensive-analytics/"]}),$="md:ml-64",E=l=>{c(l),L(!0)},x=()=>{j<6&&p(j+1)},S=()=>{j>1&&p(j-1)},k=j<6,D=j>1,r=()=>{w.current&&w.current.handleCreateTest()};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ts,{}),e.jsx("main",{className:`flex-1 flex flex-col bg-gray-50 mt-20 mb-24 transition-all duration-300 ${$}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsxs("div",{className:"md:flex md:items-start md:space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"mt-4",children:e.jsx(_,{className:"border rounded-2xl",children:e.jsxs(R,{className:"p-6 flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Create or Take Tests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Choose a quick random test, build a custom test, or view your history and scheduled competitions."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Z,{title:"Quick Random Test",subtitle:"Just choose the no. of questions and get started",icon:e.jsx(es,{className:"w-4 h-4 text-blue-800"}),onClick:()=>I(!0)}),e.jsx(Z,{title:"Build Your Own Test",subtitle:"Select subjects, chapters & topics of your choice",icon:e.jsx(Be,{className:"w-4 h-4 text-blue-800"}),onClick:()=>C(!0)}),e.jsx(Z,{title:"Scheduled Tests",subtitle:"Compete with other NEET aspirants and boost your preparation",icon:e.jsx(ss,{className:"w-4 h-4 text-blue-800"}),href:"/scheduled-tests"}),e.jsx(Z,{title:"Previous Year Questions",subtitle:"Free practice with past year papers get your confidence up",icon:e.jsx(as,{className:"w-4 h-4 text-blue-800"})})]})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto mt-4",children:[e.jsx(He,{}),(o==null?void 0:o.totalTests)===0&&e.jsx(_,{className:"border rounded-2xl",children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx(ls,{className:"h-6 w-6 text-yellow-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-700",children:"No tests yet. Take your first test to unlock insights."}),e.jsx("div",{className:"mt-3",children:e.jsx(Ge,{href:"/topics",children:e.jsx(h,{className:"bg-blue-600 hover:bg-blue-700 text-white w-full",children:"Take a Test"})})})]})})]}),y&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("header",{className:"w-full py-4 px-6 border-b border-gray-200 flex items-center gap-3",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"size-8",onClick:()=>I(!1),children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Create Random Test"})]}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(ns,{testType:"random",topics:[],onCancel:()=>I(!1),onInsufficientQuestions:E})})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("header",{className:"w-full py-4 px-6 border-b border-gray-200 flex items-center gap-3",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"size-8",onClick:()=>C(!1),children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Build Your Own Test"})]}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(is,{ref:w,onInsufficientQuestions:E,onNext:x,onPrev:S,canGoNext:k,canGoPrev:D,isLastStep:j===6,isCreating:!1,currentStep:j,onStepChange:p})}),e.jsx("footer",{className:"bg-white border-t border-gray-200 p-4 shadow-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(h,{variant:"outline",onClick:S,disabled:!D,className:"flex items-center space-x-2",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),e.jsx("div",{className:"flex space-x-2",children:j<6?e.jsxs(h,{onClick:x,disabled:!k,className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Next"}),e.jsx(V,{className:"h-4 w-4 rotate-180"})]}):e.jsxs(h,{onClick:r,className:"bg-green-600 hover:bg-green-700 flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Test"})]})})]})})]})})]}),e.jsx("aside",{className:"hidden md:block w-80 mt-4",children:e.jsx("div",{className:"space-y-4",children:e.jsx(_,{className:"border rounded-2xl",children:e.jsxs(R,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Performance Summary"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tests Taken"}),e.jsx("span",{className:"font-medium text-gray-800",children:(o==null?void 0:o.totalTests)??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Average Score"}),e.jsx("span",{className:"font-medium text-gray-800",children:(o==null?void 0:o.averageScore)??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Best Score"}),e.jsx("span",{className:"font-medium text-gray-800",children:(o==null?void 0:o.bestScore)??"â€”"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Last Test"}),e.jsx("span",{className:"font-medium text-gray-800",children:((Q=o==null?void 0:o.lastTest)==null?void 0:Q.score)??"â€”"})]})]})]})})})})]})})}),e.jsx(Je,{open:M,onOpenChange:L,children:e.jsxs(Ye,{className:"max-w-md",children:[e.jsx(Ke,{children:e.jsx(Xe,{children:"Insufficient Questions"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Available Questions:"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:g==null?void 0:g.available})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm font-medium text-orange-800",children:"Requested Questions:"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:g==null?void 0:g.requested})]})]}),e.jsx("p",{className:"text-sm text-gray-700",children:"You can reduce the number of questions, or use the available questions to continue the test."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>L(!1),className:"flex-1",children:"Back to Selection"}),e.jsxs(h,{onClick:()=>{L(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700",children:["Use ",g==null?void 0:g.available," Questions"]})]})]})})]})}function Z({title:y,subtitle:I,icon:O,href:C,onClick:M}){const[,L]=te(),g=()=>{C?L(C):M&&M()};return e.jsx(_,{onClick:g,className:"rounded-2xl border hover:shadow-lg transform hover:-translate-y-1 transition-all duration-150 cursor-pointer",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 pr-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center",children:O}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:y})}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:I})]})]}),e.jsx("div",{className:"flex items-center pr-2",children:e.jsx(h,{variant:"ghost",size:"icon","aria-label":`Open ${y}`,onClick:g,children:e.jsx(Ve,{className:"w-4 h-4 text-gray-500"})})})]})})})}export{fs as default};
